(this["webpackJsonpuse-record-mp3-example"]=this["webpackJsonpuse-record-mp3-example"]||[]).push([[0],{12:function(e,t,n){e.exports=n(24)},13:function(e,t,n){},24:function(e,t,n){"use strict";n.r(t);n(13);var r=n(0),a=n.n(r),c=n(8),u=n.n(c),o=n(4),i=n(1),l=n(9),s=n.n(l),b=n(11);var f=new Uint8Array(1048576),d=window.AudioContext||window.webkitAudioContext,p=function(e,t){var n=Object(r.useState)(!1),a=Object(i.a)(n,2),c=a[0],u=a[1],o=Object(r.useState)(!1),l=Object(i.a)(o,2),s=l[0],p=l[1],h=Object(r.useState)(null),m=Object(i.a)(h,2),g=m[0],j=m[1],O=Object(r.useState)(null),v=Object(i.a)(O,2),R=v[0],y=v[1],w=Object(r.useRef)(0),k=Object(r.useRef)([]),x=Object(r.useState)(null),S=Object(i.a)(x,2),E=S[0],A=S[1],C=Object(r.useRef)(null);e&&!t.sampleRate&&(t.sampleRate=e.getAudioTracks()[0].getCapabilities().sampleRate.max);var U=function(e,t){var n=Object(r.useState)(null),a=Object(i.a)(n,2),c=a[0],u=a[1],o=Object(r.useState)(null),l=Object(i.a)(o,2),s=l[0],d=l[1],p=Object(r.useMemo)((function(){return Object(b.a)()}),[]);return Object(r.useEffect)((function(){e&&p.then((function(n){n.configure(t.bitrate?{sampleRate:t.sampleRate||48e3,channels:t.channels||1,bitrate:t.bitrate}:{sampleRate:t.sampleRate||48e3,channels:t.channels||1,vbrQuality:t.vbrQuality||2});for(var r=0,a=!0;;){var c=a?n.encode([e]):n.finalize();if(c.length+r>f.length){var o=new Uint8Array(c.length+r);o.set(f),f=o}if(f.set(c,r),r+=c.length,!a)break;a=!1}var i=new Uint8Array(f.buffer,0,r),l=new Blob([new Uint8Array(i).buffer],{type:"audio/mpeg"}),s=URL.createObjectURL(l);u(l),d(s)}))}),[e]),[s,c]}(E,t),M=Object(i.a)(U,2),N=M[0],P=M[1],B=function(e){return function(e){return e.reduce((function(e,t){return e+t}),0)}(e)/e.length};return Object(r.useEffect)((function(){if(!1===c&&R&&g&&C.current){R&&R.disconnect(C.current.destination),g&&g.disconnect(R);var e=function(e){for(var t=[],n=e.length;n>0;n--)if(t.push(Math.abs(e[n])),t.length>50&&t.shift(),B(t)>.0075)return e.slice(0,n<e.length-5e3?n+5e3:e.length);return e}(function(e){for(var t=[],n=0;n<e.length;n++)if(t.push(Math.abs(e[n])),t.length>50&&t.shift(),B(t)>.02)return e.slice(n>5e3?n-5e3:0);return e}(function(e,t){for(var n=new Float32Array(t),r=0,a=0;a<e.length;a++){var c=e[a];n.set(c,r),r+=c.length}return n}(k.current,w.current)));A(e)}}),[c]),{isRecording:c,isRecordingPaused:s,startRecording:function(){if(e){u(!0),s||(w.current=0,k.current=[]),p(!1),C.current=new d({sampleRate:t.sampleRate});var n,r=C.current;(n=r.createScriptProcessor?r.createScriptProcessor(2048,1,1):r.createJavaScriptNode(2048,1,1)).onaudioprocess=function(e){var t=new Float32Array(e.inputBuffer.getChannelData(0));k.current.push(t),w.current=w.current+2048},y(n);var a=r.createMediaStreamSource(e);j(a),a.connect(n),n.connect(r.destination)}},stopRecording:function(){u(!1),p(!1)},pauseRecording:function(){u(!1),p(!0)},blobUrl:N,blob:P,channelData:E}},h=n(5),m=n(10),g=n.n(m);function j(){var e=Object(o.a)(["pt-4"]);return j=function(){return e},e}function O(){var e=Object(o.a)(["px-4 py-2 border border-black rounded text-lg"]);return O=function(){return e},e}function v(){var e=Object(o.a)(["px-4 mr-1 py-2 border border-black rounded text-lg"]);return v=function(){return e},e}function R(){var e=Object(o.a)(["px-4 mr-1 py-2 border border-black rounded text-lg"]);return R=function(){return e},e}function y(){var e=Object(o.a)(["p-6"]);return y=function(){return e},e}var w=function(){var e=Object(r.useState)({audio:!0}),t=Object(i.a)(e,1)[0],n=s()(t).stream,c=n&&n.getAudioTracks()[0].label,u=p(n,{sampleRate:48e3,channels:1,vbrQuality:2}),o=u.isRecording,l=u.isRecordingPaused,b=u.startRecording,f=u.stopRecording,d=u.pauseRecording,m=u.blobUrl,w=u.channelData,k=(w?function(e){for(var t=Math.floor(e.length/1e3),n=[],r=0;r<1e3;r++){for(var a=t*r,c=0,u=0;u<t;u++)c+=Math.abs(e[a+u]);n.push(c/t)}return n}(w):[]).map((function(e,t){return a.a.createElement("div",{key:t,style:{width:"0.1%",height:"".concat(100*e,"%"),backgroundColor:"red"}})}));return a.a.createElement("div",{className:Object(h.a)(y())},a.a.createElement("button",{disabled:o,className:Object(h.a)(R()),onClick:b},"Record"),a.a.createElement("button",{disabled:!(o||!o&&l),className:Object(h.a)(v()),onClick:f},"Stop"),a.a.createElement("button",{disabled:!o&&!l,className:Object(h.a)(O()),onClick:l?b:d},"Pause"),m&&a.a.createElement("div",{className:Object(h.a)(j())},a.a.createElement("audio",{controls:!0,src:m}),a.a.createElement("div",{style:{display:"flex",alignItems:"center",width:"300px",height:"100px"}},k)),c,a.a.createElement(g.a,{color:"black",position:"right",href:"https://github.com/aaronshaf/use-record-mp3"},"GitHub repo"))};u.a.render(a.a.createElement(w,null),document.getElementById("root"))}},[[12,1,2]]]);
//# sourceMappingURL=main.169fde9b.chunk.js.map